# IAM Phase 3 执行计划（User Story 1 – 架构负责人统一规范）

## 目标概述

在 Phase 3 中，我们将补充《IAM 规范》中最核心的三个章节：背景与目标、架构原则、多租户上下文责任。完成后，架构负责人应能够仅凭该规范即完成宪章对齐评审，满足 User Story 1 的独立验收条件。

## 任务拆解

### Task T006：撰写“背景与目标”章节

- **目标**：清晰说明规范编制动机、参考文档范围、适用团队及治理要求。
- **行动项**：
  1. 汇总宪章（中文优先、技术栈约束、测试要求等）与三份设计文档（`iam-v2`、`casl`、`iam-plan`）的核心诉求。
  2. 强调规范是 IAM 底座的权威指南，适用于所有参与多租户身份与授权开发的成员。
  3. 说明变更需遵循治理流程，引用 `docs/governance/iam-specification-governance.md`。
- **完成标准**：段落结构清晰、引用路径正确、可作为评审开场简介直接使用。

### Task T007：填充“架构原则”章节

- **原则范围**：多层上下文传递、CQRS+ES+EDA、一致的 CASL 权限模型、基础设施复用、中文文档/TSDoc。
- **行动项**：
  1. 每条原则须说明理由与执行要求，引用对应文档章节或宪章条款。
  2. 结合 Phase 2 参考资料附录，为原则添加来源指引。
  3. 标明执行过程中需要的关键组件（如 `MultiTenantCommandHandler`、`CaslAbilityService`）。
- **完成标准**：五条原则均落地，能直接用于评审核对；语言统一、无英文混杂。

### Task T008：整理“多租户上下文责任”小节

- **内容结构**：接口层 → 应用层 → 领域层 → 基础设施层。
- **行动项**：
  1. 说明每层应如何携带与校验 `tenantId`、`organizationId`、`departmentIds`。
  2. 引用 `docs/designs/iam-v2.md` 与 `casl` 文档中的示例（命令处理器、事件处理器、仓储）。
  3. 列出常见风险与阻断措施（如跨租户访问、上下文字段缺失、缓存污染）。
- **完成标准**：表格或小节描述完整，责任与校验要点清晰，可作为架构与代码评审的检查清单。

## 完成判定

- `docs/designs/iam-specification.md` 的前三个章节内容充实，无空白段落或 TODO。
- 架构负责人可使用该章内容在评审会上对照宪章与设计文档，且总结中包含引用提示。
- 治理团队对内容进行抽查，确认中文与术语一致，必要时在评审模板中记录检查结果。

## 后续衔接

完成 Phase 3 后，便可进入 Phase 4（User Story 2），围绕里程碑计划、职责矩阵与子域交付清单展开，将规范扩展为子域负责人可直接使用的规划工具。\*\*\* End Patch
