# IAM 里程碑与交付报告

- 生成时间：2025-11-11T08:40:14.988Z

## 阶段计划总览

| 阶段               | 目标                                                                           | 关键交付物                                                           | 质量门槛                                                       | 建议时长 |
| ------------------ | ------------------------------------------------------------------------------ | -------------------------------------------------------------------- | -------------------------------------------------------------- | -------- |
| 阶段一：基础骨架   | 落地多租户命令/查询基类、CLS、最小 API，打通最小多租户链路                     | `MultiTenantCommand/Query` 基类、`TenantContextModule`、最小链路演示 | 单元测试覆盖 ≥80%；最小链路通过 E2E；上下文校验日志无异常      | 2-3 周   |
| 阶段二：协议与授权 | 实现 OAuth2/OIDC/SAML、CASL 能力工厂、事件驱动刷新，实现多协议认证与权限一致性 | 协议守卫、CASL 能力缓存、事件处理器、Feature Flag                    | 能力缓存刷新 ≤2 分钟；事件投影滞后 <30 秒；关键接口 p95 <250ms | 3-4 周   |
| 阶段三：组织与审计 | 完成组织/部门聚合、审计服务联通、灰度准备，保证跨层级权限与审计可追溯          | 组织树查询、审计日志、跨租户校验示例、灰度策略                       | 关键路径测试覆盖 ≥90%；审计事件可追溯率 100%；灰度回滚演练完成 | 3 周     |
| 阶段四：测试与治理 | 完成单元/集成/E2E、宪章检查、上线准备，输出治理与验收资料                      | 测试报告、Constitution Check、集成验收清单、上线 checklist           | 所有宪章检查项通过；无 P0/P1 缺陷；上线清单获批准并归档        | 2 周     |

## 最近变更日志

| 版本   | 日期       | 编写人               | 计划评审日期 | 变更摘要                                                        | 备注                                      |
| ------ | ---------- | -------------------- | ------------ | --------------------------------------------------------------- | ----------------------------------------- |
| v0.1.0 | 2025-11-12 | 架构负责人（待指派） | 2025-11-18   | Phase 2 参考资料与治理流程落地，准备 US1 补写                   | 基线引用与流程齐备                        |
| v0.1.0 | 2025-11-12 | 架构负责人（待指派） | 2025-11-18   | Phase 3 完成核心章节（背景、原则、上下文责任），可启动评审      | User Story 1 验收完成                     |
| v0.1.0 | 2025-11-13 | 架构负责人（待指派） | 2025-11-18   | Phase 4 补齐里程碑计划、职责矩阵、子域交付清单                  | 支持子域负责人制定阶段计划                |
| v0.1.0 | 2025-11-13 | 架构负责人（待指派） | 2025-11-18   | Phase 5 补充合规检查、评审模板、治理脚本与事件契约              | 治理团队可独立执行审计                    |
| v1.0.0 | 2025-11-14 | 架构负责人（待签字） | 2025-11-18   | Baseline 发布：完成 Quickstart 验证与阶段总结，进入正式执行阶段 | Links: reports/iam-baseline-quickstart.md |

## 子域交付清单概览

| 子域           | 交付物                                               | 依赖                                     | 质量门槛                                     | 责任角色                    | 对应阶段  |
| -------------- | ---------------------------------------------------- | ---------------------------------------- | -------------------------------------------- | --------------------------- | --------- |
| Tenant         | 租户聚合、Provisioning Saga、租户上下文注入          | SharedKernel、Infrastructure、Interfaces | 覆盖率 ≥85%；Provisioning 审计日志齐备       | 子域负责人（Tenant）        | Phase 1-2 |
| Organization   | 组织/部门聚合、树形查询、跨层级权限继承              | Tenant、Authorization                    | 组织读接口 p95 <300ms；跨层权限测试覆盖      | 子域负责人（Organization）  | Phase 3   |
| Auth           | 认证协议适配、会话管理、登录守卫                     | Tenant、Infrastructure                   | 协议回归测试 100%；安全评估通过              | 子域负责人（Auth）          | Phase 2   |
| Authorization  | CASL 能力工厂、事件溯源聚合、能力缓存刷新            | Tenant、Auth、SharedKernel               | 能力缓存命中率 ≥90%；刷新 ≤2 分钟            | 子域负责人（Authorization） | Phase 2   |
| SharedKernel   | 值对象、异常、时间模型、ID 模板                      | -                                        | 新增值对象具备 TSDoc、单元测试；跨子域复用率 | 平台基础设施团队            | Phase 1-4 |
| Infrastructure | CLS、BaseTenantRepository、Event Store、AuditService | SharedKernel                             | CLS 覆盖所有入口；事件存储多租户隔离验证     | 平台基础设施团队            | Phase 1-3 |
| Interfaces     | MultiTenantController、守卫、拦截器、异常过滤器      | Tenant、Auth、Authorization              | 接口层上下文校验 100%；E2E 场景通过          | 接口层负责人                | Phase 1-4 |
