# IAM 规范治理流程

## 1. 规范生命周期

| 状态       | 说明                                   | 进入条件                     | 退出条件                     |
| ---------- | -------------------------------------- | ---------------------------- | ---------------------------- |
| Draft      | 初稿阶段，内容由架构负责人起草         | 创建文档并完成初步框架       | 提交至评审会                 |
| Reviewing  | 评审阶段，等待架构委员会与治理团队审核 | 召开评审会议，记录在评审模板 | 获批进入 Baseline 或驳回返工 |
| Baseline   | 基线版本，作为执行与合规依据           | 评审通过并在变更日志登记     | 触发重大变更进入 Amending    |
| Amending   | 变更阶段，处理宪章更新/风险补救        | 提交变更提案并获准修改       | 评审完成后重新进入 Baseline  |
| Deprecated | 废止状态，保留审计记录                 | 新版本替代旧版规范           | -                            |

## 2. 审批流程

1. **提案提交**：由责任人撰写变更提案，说明变更范围、原因、影响面，并引用本规范相关章节。
2. **会议审核**：利用 `docs/governance/iam-specification-review-template.md` 召开评审会，核对章节、宪章条款、风险与行动项。
3. **签字确认**：审批人核准后在评审模板与 `iam-specification-change-log.md` 上签字或记录姓名。
4. **变更执行**：按照行动项完成代码、文档或流程更新。
5. **归档通知**：在指定渠道（邮件、IM 频道）发布变更摘要，同时归档相关文档。

## 3. 版本晋级条件

- 所有相关章节更新完成并经责任人交叉审阅。
- Constitution Check 全部通过或列出补救计划。
- 变更日志新增条目并附带评审结论。
- 若涉及高风险修改（权限、上下文、日志、异常），需附测试/审计证据。

## 4. 通知与归档机制

- **通知渠道**：架构群、治理公告频道、邮件列表。
- **通知内容**：版本号、变更摘要、生效日期、影响子域、行动项。
- **归档位置**：`docs/governance/` 目录下存放评审记录、补救报告、测试证明。
- **时间要求**：重大变更需在批准后 1 个工作日内完成通知与归档。

## 5. 角色职责映射

| 角色             | 职责                                            | 宪章引用     |
| ---------------- | ----------------------------------------------- | ------------ |
| 架构负责人       | 维护规范、组织评审、裁决冲突                    | 宪章 II, III |
| 治理团队         | 执行 Constitution Check、维护变更日志与评审记录 | 宪章 I, IV   |
| 子域负责人       | 反馈子域影响、执行行动项、更新子域文档          | 附加约束     |
| 平台基础设施团队 | 确保配置、日志、异常、缓存实现符合规范          | 宪章 V-VIII  |
| 测试与质量团队   | 验证测试覆盖率与审计证据，提供报告              | 宪章 IV      |

## 6. 合规依据

- 宪章 I：中文优先原则 — 本流程要求所有文档与记录使用中文。
- 宪章 II：代码即文档原则 — 变更执行必须同步更新 TSDoc 与本规范。
- 宪章 III-VIII：技术栈与基础设施约束 — 审批时需确认依赖与实现符合条款。
- 附加约束：多租户隔离、DDD + CQRS + ES + EDA — 评审须验证架构模式未偏离。

## 7. 触发与回溯

- **触发条件**：宪章更新、设计文档变更、治理检查缺口、重大风险事件、阶段评审结论。
- **回溯流程**：若实施后发现问题，可将状态置为 Amending，记录回溯步骤与影响范围，必要时回滚至前一版本。

## 8. Quickstart 验证记录

- **执行日期**：2025-11-14
- **参与角色**：架构负责人、治理团队、接口层负责人
- **验证范围**：
  - 规范大纲与职责矩阵同步完成，引用资料覆盖 D1-D6。
  - Constitution Check 脚本入口（`pnpm run iam:constitution-check`、`pnpm run iam:milestone-report`）已就绪。
  - 子域交付清单、阶段计划与治理流程能够互相引用。
- **结论**：Quickstart 五个步骤均按指引完成，未发现阻塞问题。详细记录见 `docs/governance/reports/iam-baseline-quickstart.md`。
- **后续跟进**：实现脚本主体逻辑并自动归档报告。

## 9. 阶段评审总结

| 阶段    | 关键成果                               | 主要风险/补救        | 后续行动             |
| ------- | -------------------------------------- | -------------------- | -------------------- |
| Phase 1 | 完成规范大纲、审计资产框架             | 无                   | 依据大纲填充细节     |
| Phase 2 | 引用体系与治理流程落地                 | 需持续维护资料准确性 | 定期更新参考资料表   |
| Phase 3 | 核心章节（背景、原则、上下文责任）完备 | 权限缓存刷新需监控   | 建立缓存监控告警策略 |
| Phase 4 | 里程碑计划、职责矩阵、子域清单齐备     | 子域依赖需持续协调   | 定期召开跨域同步会   |
| Phase 5 | 合规检查、治理脚本与事件契约完善       | 脚本尚为占位         | Phase 6 后开发脚本   |
| Phase 6 | Baseline 发布与治理总结                | 无                   | 进入自动化治理阶段   |

## 10. 自动化治理脚本

- `pnpm run iam:constitution-check`：执行规范章节、评审模板、风险状态等 8 项校验，输出 JSON / Markdown 报告并在存在未关闭风险时返回非零状态。
- `pnpm run iam:milestone-report [--json]`：汇总阶段计划、变更日志、子域交付清单，并验证数据完整性（不足或缺失时返回非零状态）。
- `pnpm run governance:check`：组合执行上述脚本，已在 `turbo.json` 注册为 `governance:check` 任务，可在 CI 中使用 `turbo run governance:check` 调用。

> 任一脚本失败会立即中断，确保治理风险在 CI 中被及时发现。

> 本治理文档应与评审模板、变更日志同步维护，任何流程更新必须优先调整本文件并通知相关团队。\*\*\*
