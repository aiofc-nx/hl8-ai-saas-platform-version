# IAM 优先建设备忘录

## 🎯 背景

作为多租户 SaaS 平台，身份认证与权限管理（IAM）具备**全局性**与**基础性**。近期在梳理多租户规范（domain/application/infrastructure/interface guides）与 `libs/infra/multi-tenancy` 模块时，再次确认 IAM 是所有领域能力的前置依赖，需要尽快落地。

## ✅ IAM 前置建设的理由

| 维度 | 说明 |
| --- | --- |
| 安全合规 | 统一的认证、授权、租户上下文是防止越权访问与数据泄露的根基；后置补齐成本极高。 |
| 业务依赖 | 组织管理、流程引擎、报表 BI 等模块都需要稳定的用户/角色/策略支撑。 |
| 多租户隔离 | 租户级、组织级、部门级隔离需要 IAM 提供统一的能力建模（例如 CASL 规则、策略模板）。 |
| 运维治理 | 登录日志、权限审计、跨租户操作审批都是平台级治理能力，IAM 是第一步。 |
| 扩展复用 | 优先完成 IAM，可为未来的模块提供统一的 SSO 接入、API Key、OAuth 2.0 等能力。 |

## 📚 现有资料

- `docs/designs/iam.md`：详述 IAM 架构、功能列表、API 设计与权限模型；
- `docs/designs/casl-muti-tenant-auth-cqrs-es-eda.md`：结合 CASL、CQRS、事件溯源的权限治理方案；
- 多租户指南（`docs/guides/*.md`）已补充多层隔离规则，可作为 IAM 落地时的依赖条目。

## 🔜 建议的优先开发内容

1. **基础认证能力**：账号体系、租户绑定、登录流程（含 MFA / SSO 扩展点）。
2. **权限建模**：基于 CASL 的角色与策略，支持租户级/组织级/部门级授权。
3. **租户上下文服务**：CLS、指令校验、后台任务上下文切换，与 `libs/infra/multi-tenancy` 深度整合。
4. **审计与日志**：用户行为审计、权限变更记录，落地统一日志规范。
5. **集成入口**：API Gateway / 控制台统一鉴权，在应用层 handler 前校验身份。

## 🛠️ 推进建议

1. 将 IAM 列为“平台底座”第一优先级，与配置、日志、异常等模块同步规划。
2. 拆分开发任务，引用现有设计文档作为蓝本，结合多租户指南的审计/隔离要求执行。
3. 在后续迭代中，将 IAM 设计与实现成果反哺到 `docs/guides` 和基础设施模块，保持文档-代码一致性。

---

*文档更新时间：2025-11-10*  
*维护人：GPT-5 Codex（自动生成，可作为后续工作计划的参考）*

