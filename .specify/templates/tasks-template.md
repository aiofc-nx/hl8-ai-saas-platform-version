---

description: "特性实施任务清单模板"
---

# 任务清单：[FEATURE NAME]

**输入**：来自 `/specs/[###-feature-name]/` 的设计文档  
**前置文件**：plan.md（必需）、spec.md（记录用户故事时必需）、research.md、data-model.md、contracts/

**测试说明**：下方示例包含测试任务。只有在规格文档明确要求测试时才需要保留；否则请移除测试任务并在实现任务中明确覆盖率达标策略。

**组织方式**：任务按用户故事分组，确保每个故事可以独立实现与验证。

## 格式规范：`[ID] [P?] [Story] 描述`

- **[P]**：可并行执行（操作不同文件且无依赖）
- **[Story]**：所属用户故事（例如 US1、US2、US3）
- 描述中必须包含精确文件路径

## 路径约定

- **单体项目**：`src/`、`tests/` 位于仓库根目录
- **前后端分离项目**：`backend/src/`、`frontend/src/`
- **移动端项目**：`api/src/`、`ios/src/` 或 `android/src/`
- 以下示例默认单体结构，若结构不同请调整

<!-- 
  ============================================================================
  重要：以下任务仅为示例，占位内容必须由 /speckit.tasks 命令替换。
  真实任务应基于：
  - spec.md 中的用户故事及优先级
  - plan.md 的功能要求
  - data-model.md 中的实体设计
  - contracts/ 中的契约定义
  生成的 tasks.md 必须按用户故事组织，保证：
  - 每个故事可独立开发
  - 每个故事可独立测试
  - 每个故事为可交付的 MVP 增量
  请勿在交付的任务文件中保留本示例。
  ============================================================================
-->

## 阶段 1：环境搭建（共享基础设施）

**目的**：初始化项目结构与基础依赖

- [ ] T001 建立与实施计划一致的项目结构
- [ ] T002 初始化 Node.js + TypeScript 项目并安装所需依赖（NestJS、Fastify、pnpm 等）
- [ ] T003 [P] 配置 ESLint、Prettier、Commitlint 等质量工具

---

## 阶段 2：基础能力（阻塞项）

**目的**：实现所有用户故事共享的核心基础设施

**⚠️ 严格要求**：此阶段完成前不得开始任何用户故事任务

示例（请根据项目实际调整）：

- [ ] T004 建立数据库模式并编写 MikroORM 迁移
- [ ] T005 [P] 实现认证/授权框架，集成 CASL 策略
- [ ] T006 [P] 搭建 API 路由与中间件结构（基于 NestJS + Fastify）
- [ ] T007 创建所有用户故事依赖的基础实体
- [ ] T008 配置统一异常处理，使用 `libs/infra/exceptions`
- [ ] T009 搭建配置管理，使用 `@hl8/config` 并完成校验
- [ ] T010 集成 `@hl8/logger` 并定义日志上下文

**检查点**：基础设施准备完毕，可启动用户故事工作

---

## 阶段 3：用户故事 1 - [标题]（优先级：P1）🎯 MVP

**目标**：[简述该故事交付的能力]

**独立验证方式**：[说明如何单独验证该故事]

### 用户故事 1 的测试（仅在规格要求测试时保留）⚠️

> **注意：测试必须先行编写并确认失败，再进行实现。**

- [ ] T011 [P] [US1] 在 `tests/contract/` 编写契约测试
- [ ] T012 [P] [US1] 在 `tests/integration/` 编写集成测试
- [ ] T013 [P] [US1] 在 `tests/e2e/` 编写端到端流程（如需）

### 用户故事 1 的实现

- [ ] T014 [P] [US1] 在 `src/models/` 创建相关实体与 TSDoc
- [ ] T015 [P] [US1] 在 `src/services/` 实现领域服务并补充 TSDoc
- [ ] T016 [US1] 在 `src/` 对应目录实现接口/控制器
- [ ] T017 [US1] 实现配置、缓存、日志集成，符合章程约束
- [ ] T018 [US1] 补充单元测试，确保覆盖率达成计划

**检查点**：用户故事 1 可独立运行与验证

---

## 阶段 4：用户故事 2 - [标题]（优先级：P2）

**目标**：[简述该故事交付的能力]

**独立验证方式**：[说明如何单独验证该故事]

### 用户故事 2 的测试（仅在规格要求测试时保留）⚠️

- [ ] T019 [P] [US2] 在 `tests/contract/` 编写契约测试
- [ ] T020 [P] [US2] 在 `tests/integration/` 编写集成测试

### 用户故事 2 的实现

- [ ] T021 [P] [US2] 在 `src/models/` 创建实体
- [ ] T022 [US2] 在 `src/services/` 实现服务逻辑
- [ ] T023 [US2] 在 `src/` 对应目录实现接口/控制器
- [ ] T024 [US2] 按需与用户故事 1 组件集成，保持边界清晰

**检查点**：用户故事 1 与 2 均可独立运行与验证

---

## 阶段 5：用户故事 3 - [标题]（优先级：P3）

**目标**：[简述该故事交付的能力]

**独立验证方式**：[说明如何单独验证该故事]

### 用户故事 3 的测试（仅在规格要求测试时保留）⚠️

- [ ] T025 [P] [US3] 在 `tests/contract/` 编写契约测试
- [ ] T026 [P] [US3] 在 `tests/integration/` 编写集成测试

### 用户故事 3 的实现

- [ ] T027 [P] [US3] 在 `src/models/` 创建实体
- [ ] T028 [US3] 在 `src/services/` 实现服务逻辑
- [ ] T029 [US3] 在 `src/` 对应目录实现接口/控制器

**检查点**：全部用户故事完成且彼此独立可验证

---

[根据特性规模按上述模式继续扩展用户故事阶段]

---

## 阶段 N：打磨与跨切关注点

**目的**：处理影响多个用户故事的提升项

- [ ] TXXX [P] 更新 `docs/` 文档（含中文 TSDoc 摘要）
- [ ] TXXX 代码清理与重构，确保遵循章程约束
- [ ] TXXX 性能优化并记录基线结果
- [ ] TXXX [P] 在 `tests/unit/` 增补缺漏测试，提升覆盖率
- [ ] TXXX 安全与租户隔离加固
- [ ] TXXX 校验 quickstart.md 并更新

---

## 依赖与执行顺序

### 阶段依赖

- **阶段 1：环境搭建**：无前置，可立即开始
- **阶段 2：基础能力**：依赖阶段 1，完成前阻塞全部用户故事
- **阶段 3+：用户故事实现**：依赖阶段 2；完成后各故事可并行或按优先级顺序（P1 → P2 → P3）执行
- **阶段 N：打磨**：依赖所有目标用户故事完成

### 用户故事依赖

- **用户故事 1（P1）**：阶段 2 完成后即可开始，无其他故事依赖
- **用户故事 2（P2）**：阶段 2 完成后可启动，必要时与用户故事 1 集成，但必须保持独立可测试
- **用户故事 3（P3）**：阶段 2 完成后可启动，可复用先前组件但不得破坏独立性

### 用户故事内部顺序

- 测试必须在实现前编写并确认失败
- 模型先于服务
- 服务先于接口/控制器
- 核心实现完成后再做集成
- 在切换至下一优先级前，确保当前故事可独立交付

### 并行机会

- 阶段 1 中标记 `[P]` 的任务可并行
- 阶段 2 中标记 `[P]` 的任务可并行（但需注意依赖）
- 完成阶段 2 后，不同用户故事可并行推进
- 单个用户故事内标记 `[P]` 的模型或测试任务可并行
- 不同故事之间的任务天然可分配给不同成员

---

## 实施策略

### MVP 优先（仅交付用户故事 1）

1. 完成阶段 1：环境搭建
2. 完成阶段 2：基础能力（关键阻塞）
3. 完成阶段 3：用户故事 1
4. **暂停并验证**：执行测试，确认覆盖率达标
5. 若可交付则发布/演示

### 渐进式交付

1. 完成阶段 1 + 阶段 2 → 基础设施就绪
2. 添加用户故事 1 → 测试 → 发布/演示（TDD）
3. 添加用户故事 2 → 测试 → 发布/演示
4. 添加用户故事 3 → 测试 → 发布/演示
5. 每个故事都在不破坏先前成果的前提下持续累积价值

### 多人并行策略

1. 团队协作完成阶段 1 + 阶段 2
2. 基础设施就绪后：
   - 成员 A：负责用户故事 1
   - 成员 B：负责用户故事 2
   - 成员 C：负责用户故事 3
3. 各故事独立完成并在阶段 N 聚合

---

## 备注

- 标记 `[P]` 的任务表示可在不同文件上并行进行
- `[Story]` 标签用于追踪任务所属用户故事
- 每个用户故事都必须可独立完成并测试，保障租户隔离与章程合规
- 编写实现前先写测试，确保测试初次运行失败
- 每完成一个任务或逻辑分组即提交一次，提交信息请使用英文
- 可在任意检查点暂停并验证当前用户故事
- 避免含糊任务、跨故事耦合或破坏独立性的依赖
